---
- name: Create alert_manager storage path
  file:
    state: directory
    path: "{{ storage_path }}"

# - name: Set alert_manager container facts
#   set_fact:
#     alert_manager_container: &alert_manager_container_ref
#       name: alert_manager
#       hostname: alert_manager
#       image: "{{ docker_image }}"
#       restart_policy: always
#       publish_all_ports: yes
#       command: server /data --console-address ":9001"
#       mounts:
#         - source: "{{ storage_path }}"
#           target: /data

- name: Import container action task
  import_task: container_action.yaml
  vars:
    docker_action: "{{ docker_action }}"
    container_params:
      name: alert_manager
      hostname: alert_manager
      image: "{{ docker_image }}"
      restart_policy: always
      publish_all_ports: yes
      command: server /data --console-address ":9001"
      mounts:
        - source: "{{ storage_path }}"
          target: /data
# - name: Run alert_manager container
#   when: docker_action == 'start'
#   community.docker.docker_container:
#     state: started
#     <<: *minio_container_ref

# - name: Restart alert_manager container
#   when: docker_action == 'restart'
#   community.docker.docker_container:
#     state: started
#     restart: yes
#     <<: *minio_container_ref

# - name: Stop alert_manager container
#   when: "{{ docker_action == 'stop' }}"
#   community.docker.docker_container:
#     state: stopped
#     <<: *minio_container_ref
