---
- name: Pull minio client docker image
  import_role:
    name: docker_image
    tasks_from: pull
  vars:
    docker_image: "{{ minio_mc_image }}"

- name: Set minio facts
  set_fact:
    mounts: []
    disk_range: "{{ num_of_drives + 1 }}"
    host_range: "{{ num_of_hosts + 1 }}"

- name: Loop through mount range
  loop: "{{ range(1, disk_range) }}"
  set_fact:
    mounts: "{{  }}"

- name: Import container action task for minio
  import_task: container_action.yaml
  vars:
    docker_action: "{{ docker_action }}"
    container_params:
      name: minio
      hostname: minio
      image: "{{ docker_image }}"
      restart_policy: always
      publish_all_ports: yes
      command: "server {{ protocol }}://{{ hostname }}{1...{{ num_of_hosts }}}/data{1...{{ disk_range }}} --console-address ':9001'"
      mounts:
        - source: "{{ storage_path }}"
          target: /data
